<!doctype html>
<html>
<head>
	<meta charset='utf-8'>
	<title>BoHip</title>

	<link rel="stylesheet" href="vendor/normalize-css/normalize.css">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lobster+Two:400,700">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:100,700">

	<link rel="stylesheet" href="assets/main.css">

	<script src="vendor/d3/d3.js"></script>
	<script src="vendor/trianglify/trianglify.js"></script>
	<script src="vendor/hogan/web/builds/2.0.0/hogan-2.0.0.js"></script>
	
</head>
<body>
<script>
	var page = d3.select('body');
	
	var trianglifyOpts = {
		noiseIntensity: 0, 
		cellpadding: 10, 
		cellsize: 100
	};

	// Aesthetics
	var boganbg = new Trianglify(trianglifyOpts)
						.generate(500, 50)
						.dataUrl;

	var hipsterbg = new Trianglify(trianglifyOpts)
						.generate(500, 50)
						.dataUrl;

	// Main card template
	var card = Hogan.compile("<card class='card {{Classes}}' style='background-image:{{Image}}'>"+
								"<h1>{{{Title}}}</h1>"+
								"<category>{{Category}}</category>" +
								"{{#Counter}}" +
									"<counter>{{Counter}}</counter>" +
								"{{/Counter}}" +
							"</card>");

	// Get CSV
	d3.csv("data.csv", function(err, rows) {
		var cards = [];
		rows.map(function(row) {
			for (var i = row.Counter - 1; i >= 0; i--) {

				var classes = row.Position.split(' ');
				classes.push(row.Category);

				classes = classes.join(' ').toLowerCase();

				var count = (row.Counter > 1) ? (i+1) + " of " + row.Counter : '';

				cards.push(
					// Bogan
					card.render({
						Title: titlify(row.Bogan),
						Classes: classes + ' bogan',
						Category: row.Category,
						Counter: count,
						Image: boganbg
					}),

					// Hipster
					card.render({
						Title: titlify(row.Hipster),
						Classes: classes + ' hipster',
						Category: row.Category,
						Counter: count,
						Image: hipsterbg
					})
				);
			}
		});

		page.html(cards.join(''));
	});

	function titlify (title) {
		if (!title.match(': '))
			return title;

		title = title.split(/: /);
		return title[0] + "<br><span>" + title[1] + "</span>";
	}
</script>
</body>
</html>